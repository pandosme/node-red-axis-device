<script type="text/x-red" data-template-name="axis-device">
    <div class="form-row">
        <label for="node-input-account"><i class="icon-tag"></i> Credentials</label>
        <input type="text" id="node-input-account">
    </div>
    <div class="form-row">
        <label for="node-input-address"><i class="icon-tag"></i> Address</label>
        <input type="text" id="node-input-address" placeholder="IP or FQDN">
    </div>
    <div class="form-row">
        <label for="node-input-action"><i class="icon-tag"></i> Action</label>
        <select id="node-input-action">
            <option value="Device Info">Device Info</option>
            <option value="Network settings">Network settings</option>
            <option value="Reboot">Reboot</option>
            <option value="Upgrade firmware">Upgrade firmware</option>
            <option value="HTTP Get">HTTP Get</option>
            <option value="HTTP Post">HTTP Post</option>
		</select>
	</div>
    <div class="form-row cgi_get">
        <label for="node-input-cgi"><i class="icon-tag"></i> CGI</label>
        <input type="text" id="node-input-cgi" placeholder="/axis-cgi/... (alt. inject msg.cgi)">
    </div>
    <div class="form-row cgi_post">
        <label for="node-input-data"><i class="icon-tag"></i> Data</label>
        <input type="text" id="node-input-data" placeholder="alt. inject msg.payload">
    </div>
</script>

<script type="text/javascript">
RED.nodes.registerType('axis-device',{
	category: 'Axis',
	color: '#FFFF00',
	defaults: {
		account: {type:"axis-config"},
		address: {value:""},
		action: { value:"Device Info"},
		cgi: { value:""},
		data: {value:""}
	},
	icon: "camera-icon2.png",
	inputs:1,
	outputs:1,
	label: function() {
		return this.action || "Axis Device";
	},
	oneditprepare: function() {
		$("#node-input-action").change(function() {
			var action = $("#node-input-action").val();
			console.log("oneditprepare");
			$(".cgi_request").hide();
			switch (action) {
				case "Device Info":
					$(".cgi_get").hide();
					$(".cgi_post").hide();
				break;
				case "Network settings":
					$(".cgi_get").hide();
					$(".cgi_post").hide();
				break;
				case "Reboot":
					$(".cgi_get").hide();
					$(".cgi_post").hide();
				break;
				case "Upgrade firmware":
					$(".cgi_get").hide();
					$(".cgi_post").hide();
				break;
				case "HTTP Get":
					$(".cgi_get").show();
					$(".cgi_post").hide();
				break;
				case "HTTP Post":
					$(".cgi_get").show();
					$(".cgi_post").show();
				break;
			}
		});
	}
});
</script>

<script type="text/x-red" data-help-name="axis-device">
	<h2>Axis Device</h2>
	<h3>Inputs:</h3>
	<dl class="message-properties">
		<dt>credentials<span class="property-type">configuration</span></dt>
		<dd>Camera credentials user and password is required.<br/>
		Use <code>msg.user</code> and <code>msg.password</code> to override config</dd>
	</dl>	
	
	<dl class="message-properties">
		<dt>address<span class="property-type">string</span></dt>
		<dd>IP address or FQDN.<br/>
		Use <code>msg.address</code> to override config</dd>
	</dl>	

	<dl class="message-properties">
		<dt>Action<span class="property-type">string</span></dt>
		<dd>Use <code>msg.action</code> to override config</dd>
	</dl>	

	<dl class="message-properties">
		<dt>CGI<span class="property-type">string</span></dt>
		<dd>For VAPIX HTTP Get and Post.  See Axis VAPIX documentation.  Use <code>msg.cgi</code> to override config<br/>
		For Post, use <code>msg.payload</code> to override Data config.  Objects will be automatically converted to JSON.</dd>
	</dl>	

	<dl class="message-properties">
		<dt>Data<span class="property-type">string | object | buffer</span></dt>
		<dd>Depends on action<br/>
		Use <code>msg.payload</code> to override config.
		</dd>
	</dl>	

	<h3>Outputs:</h3>
	<dl class="message-properties">
		<dt>msg.error<span class="property-type">bool | string</span></dt>
		<dd>On success, error will be <code>false</code><br/>
		On failure, error will be <code>true</code> or message string</dd>
	</dl>	

	<dl class="message-properties">
		<dt>msg.payload<span class="property-type">bool | string | buffer</span></dt>
		<dd>Depends on action</dd>
	</dl>	

</script>
